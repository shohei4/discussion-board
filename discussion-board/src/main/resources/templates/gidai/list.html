<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<title>議題一覧</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
	<!-- 議題登録成功メッセージの表示 -->
	<div id="success-message" class="alert alert-success d-none text-center" role="alert"></div>
	<div class="container mt-5">
		<h2 class="mb-4">議題一覧</h2>
		<table class="table table-striped table-hover" id="gidaiTable">
			<thead class="table-dark">
				<tr>
					<th>ID</th>
					<th>議題名</th>
					<th>ジャンル</th>
					<th>作成者</th>
				</tr>
			</thead>
			<tbody>
				<!-- JavaScriptで挿入 -->
			</tbody>
		</table>
		<a th:href="@{/view/gidai/registration}">新規登録はこちら</a>
	</div>

	<script>
		window.addEventListener('DOMContentLoaded', () => {
			// メッセージ表示
			const message = sessionStorage.getItem('successMessage');
			if (message) {
				const messageDiv = document.getElementById('success-message');
				if (messageDiv) {
					messageDiv.innerText = message;
					messageDiv.classList.remove('d-none');
				}
				sessionStorage.removeItem('successMessage');
			}

			// Gidai データ取得
			const tbody = document.querySelector('#gidaiTable tbody');
			if (tbody) {
				fetch('/api/gidai')
					.then(res => res.json())
					.then(data => {
						data.forEach(gidai => {
							const tr = document.createElement('tr');
							tr.innerHTML = `
		                        <td>${gidai.id}</td>
		                        <td>${gidai.gidai}</td>
		                        <td>${gidai.genre}</td>
		                        <td>${gidai.userSummary?.username || ''}</td>
		                    `;
							tbody.appendChild(tr);
						});
					})
					.catch(err => console.error('Error fetching Gidai:', err));
			}
		});

	</script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>